Here are **detailed notes on âœ… 10. Ansible Roles**, including what they are, why theyâ€™re used, directory structure, example usage, and **interview Q\&A with scenario-based questions**. Every section includes official documentation links.

---

# âœ… 10. Ansible Roles â€“ Full Guide

---

## ğŸ”¹ What Are Roles in Ansible?

An **Ansible Role** is a structured way of organizing playbooks and files by **splitting tasks into reusable components**.

Roles help you:

* Organize complex playbooks
* Reuse code across projects
* Maintain modular, scalable, and readable automation

ğŸ“˜ [Official Docs â€“ Roles](https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html)

---

## ğŸ”¹ Why Use Roles?

| Benefit             | Description                          |
| ------------------- | ------------------------------------ |
| âœ… Modularity        | Code is separated into logical units |
| âœ… Reusability       | Roles can be reused across projects  |
| âœ… Scalability       | Easy to manage in large environments |
| âœ… Cleaner Playbooks | Keeps playbooks short and readable   |
| âœ… Better Structure  | Follows Ansible best practices       |

---

## ğŸ”¹ Standard Role Directory Structure

```bash
roles/
â””â”€â”€ webserver/
    â”œâ”€â”€ tasks/
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ handlers/
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ defaults/
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ vars/
    â”‚   â””â”€â”€ main.yml
    â”œâ”€â”€ files/
    â”œâ”€â”€ templates/
    â”œâ”€â”€ meta/
    â”‚   â””â”€â”€ main.yml
    â””â”€â”€ README.md
```

### ğŸ“ Explanation of Directories

| Folder       | Purpose                                   |
| ------------ | ----------------------------------------- |
| `tasks/`     | Main list of tasks                        |
| `handlers/`  | Contains handlers (e.g., restart service) |
| `defaults/`  | Default variables (lowest precedence)     |
| `vars/`      | Higher precedence variables               |
| `files/`     | Static files to copy                      |
| `templates/` | Jinja2 templates                          |
| `meta/`      | Metadata, dependencies, author info       |

---

## ğŸ”¹ How to Create a Role

### âœ… 1. Using the CLI:

```bash
ansible-galaxy init <role_name>
```

Example:

```bash
ansible-galaxy init webserver
```

This will auto-create the role structure under `roles/webserver`.

---

## ğŸ”¹ How to Use a Role in a Playbook

```yaml
- name: Apply webserver role
  hosts: web
  become: true
  roles:
    - webserver
```

Roles will automatically use files like `tasks/main.yml`, `handlers/main.yml`, etc.

---

## ğŸ”¹ Example â€“ `roles/webserver/tasks/main.yml`

```yaml
- name: Install nginx
  apt:
    name: nginx
    state: present

- name: Copy nginx config
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/nginx.conf
  notify: restart nginx
```

---

## ğŸ”¹ Using Role Variables

### `defaults/main.yml`

```yaml
nginx_port: 80
```

Use in template or task:

```yaml
- debug:
    var: nginx_port
```

---

## ğŸ”¹ Role Dependencies (`meta/main.yml`)

You can include other roles as dependencies:

```yaml
dependencies:
  - role: common
  - role: firewall
```

ğŸ“˜ [Role Dependencies](https://docs.ansible.com/ansible/latest/user_guide/roles_dependencies.html)

---

## âœ… Interview Questions & Scenario-Based Q\&A

---

### â“ Q1: What is the difference between a playbook and a role?

| Playbook           | Role                         |
| ------------------ | ---------------------------- |
| Linear YAML        | Structured, reusable unit    |
| Harder to reuse    | Easily reusable across plays |
| No standard layout | Enforced directory layout    |

---

### â“ Q2: When should you use roles?

**Answer:**
Use roles when your playbooks become too large, repetitive, or you need to reuse configurations across different environments or teams.

---

### â“ Q3: Scenario â€“ You are asked to deploy Apache, configure it, and ensure it's running. You need to reuse this logic in 3 projects. What do you do?

**Answer:**
Create a role `apache` and organize:

* `tasks/main.yml`: Install and configure
* `handlers/main.yml`: Restart service
* `defaults/main.yml`: Default values

Then reuse in all 3 projects by just calling:

```yaml
roles:
  - apache
```

---

### â“ Q4: What is the difference between `defaults` and `vars` in a role?

| `defaults/`            | `vars/`                |
| ---------------------- | ---------------------- |
| Lowest precedence      | Higher precedence      |
| Can be overridden      | Harder to override     |
| Used for safe defaults | Used for forced values |

---

### â“ Q5: How do you create a role using CLI?

```bash
ansible-galaxy init myrole
```

---

### â“ Q6: How do you add a dependency on another role?

In `meta/main.yml`:

```yaml
dependencies:
  - role: common
```

---

## âœ… Summary Table

| Component    | Description                    |
| ------------ | ------------------------------ |
| `tasks/`     | Defines what to do             |
| `handlers/`  | Defines actions to trigger     |
| `defaults/`  | Safe default variables         |
| `vars/`      | High-priority variables        |
| `files/`     | Static files (non-templated)   |
| `templates/` | Jinja2 templates               |
| `meta/`      | Role metadata and dependencies |

---

## ğŸ“š Official Documentation Links

| Topic             | Link                                                                                               |
| ----------------- | -------------------------------------------------------------------------------------------------- |
| Roles Overview    | [Roles](https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html)             |
| Role Dependencies | [Dependencies](https://docs.ansible.com/ansible/latest/user_guide/roles_dependencies.html)         |
| Creating Roles    | [Galaxy Init](https://docs.ansible.com/ansible/latest/cli/ansible-galaxy.html#ansible-galaxy-init) |

---

Let me know when you're ready for âœ… **11. Templates & Jinja2**, or if youâ€™d like a **PDF export** of all your Ansible notes.
