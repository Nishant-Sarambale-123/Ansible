Here are **detailed notes on âœ… Ansible Best Practices**, including project structure, security, playbook design, scaling tips, version control, and real-world recommendations â€” plus **interview Q\&A with scenarios** and official documentation links.

---

# âœ… Ansible Best Practices â€“ Complete Guide

---

## ğŸ”¹ 1. Project Directory Structure

Use a **clear, standardized directory structure** for readability, reusability, and scalability.

### âœ… Recommended Layout:

```
project/
â”œâ”€â”€ inventories/
â”‚   â”œâ”€â”€ dev/
â”‚   â”‚   â””â”€â”€ hosts.yml
â”‚   â””â”€â”€ prod/
â”‚       â””â”€â”€ hosts.yml
â”œâ”€â”€ roles/
â”‚   â”œâ”€â”€ webserver/
â”‚   â”‚   â”œâ”€â”€ tasks/
â”‚   â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”œâ”€â”€ defaults/
â”‚   â”‚   â””â”€â”€ vars/
â”œâ”€â”€ group_vars/
â”‚   â””â”€â”€ all.yml
â”œâ”€â”€ playbooks/
â”‚   â”œâ”€â”€ site.yml
â”‚   â””â”€â”€ deploy.yml
â”œâ”€â”€ requirements.yml
â””â”€â”€ ansible.cfg
```

ğŸ“˜ [Best Practices Guide](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html)

---

## ğŸ”¹ 2. Use Roles to Organize Code

Split functionality into roles for **modularity** and **reuse**.

```bash
ansible-galaxy init nginx
```

Each role should:

* Handle one job (e.g., nginx setup, user management)
* Be independently testable
* Avoid interdependency

ğŸ“˜ [Roles Best Practices](https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html)

---

## ğŸ”¹ 3. Use Inventories per Environment

Keep `dev`, `staging`, `prod` separated in:

```
inventories/
â”œâ”€â”€ dev/
â”œâ”€â”€ staging/
â””â”€â”€ prod/
```

This avoids **accidental deployment to production** and allows **environment-specific configuration**.

---

## ğŸ”¹ 4. Use Group/Host Variables

Use `group_vars/` and `host_vars/` for managing environment or host-specific settings.

```yaml
group_vars/webservers.yml
host_vars/web1.example.com.yml
```

---

## ğŸ”¹ 5. Follow Idempotency

Design tasks to be **idempotent** â€” re-running a playbook shouldn't change anything if the system is already in the desired state.

Bad:

```yaml
- name: Restart service
  shell: systemctl restart nginx
```

Better:

```yaml
- name: Ensure nginx is running
  service:
    name: nginx
    state: started
    enabled: yes
```

---

## ğŸ”¹ 6. Use Tags

Tags help **limit the scope** of playbook execution.

```yaml
- name: Install nginx
  apt:
    name: nginx
    state: present
  tags: web
```

Run:

```bash
ansible-playbook site.yml --tags "web"
```

---

## ğŸ”¹ 7. Use Ansible Vault for Secrets

Do **not hardcode passwords** or API keys in playbooks. Use Ansible Vault:

```bash
ansible-vault encrypt secrets.yml
```

Use in playbook:

```yaml
vars_files:
  - secrets.yml
```

---

## ğŸ”¹ 8. Use `check` and `diff` Modes

Run playbooks in dry-run mode to preview changes:

```bash
ansible-playbook site.yml --check --diff
```

---

## ğŸ”¹ 9. Lint and Test Playbooks

Use tools:

* âœ… `ansible-lint`: Checks for syntax & style
* âœ… `yamllint`: YAML file validator
* âœ… `molecule`: Role testing

```bash
ansible-lint playbook.yml
```

---

## ğŸ”¹ 10. Version Control with Git

Track changes in Ansible code using Git:

* Store roles/playbooks in a repo
* Use branches for dev/test/prod
* Protect `main` branch

---

## ğŸ”¹ 11. CI/CD Integration

* Run playbooks from GitHub Actions, Jenkins, GitLab
* Automate playbook tests on commits
* Deploy only on approvals

---

## ğŸ”¹ 12. Document Everything

Use:

* `README.md` per role/playbook
* Inline comments
* Task names that clearly explain actions

---

## ğŸ”¹ 13. Avoid Anti-Patterns

| âŒ Anti-Pattern              | âœ… Best Practice                    |
| --------------------------- | ---------------------------------- |
| Using `shell` unnecessarily | Use `apt`, `file`, `service`, etc. |
| Hardcoding values           | Use variables                      |
| Running as `root` always    | Use `become` carefully             |
| No error handling           | Use `block`, `rescue`, `always`    |
| Copy-paste playbooks        | Use roles or includes              |

---

## âœ… Interview Questions & Scenario-Based Q\&A

---

### â“ Q1: Why is it recommended to use roles in Ansible?

**Answer:**
Roles provide modularity, reuse, maintainability, and make it easier to organize code into components.

---

### â“ Q2: Scenario â€“ You accidentally ran a playbook on production instead of dev. How would you prevent this in the future?

**Answer:**

* Use separate inventories (`inventories/dev`, `inventories/prod`)
* Add `--limit` safety on production
* Tag critical tasks and prompt for confirmation
* Use CI/CD approval gates

---

### â“ Q3: How do you keep secrets secure in Ansible?

**Answer:**
By using **Ansible Vault** to encrypt variables and secrets.

---

### â“ Q4: What is idempotency in Ansible?

**Answer:**
A task is idempotent if it does not make changes to the system when the desired state is already met.

---

### â“ Q5: Why use `--check` mode?

**Answer:**
To perform a dry run, validating what changes **would** occur without actually applying them.

---

### â“ Q6: Scenario â€“ You want to install packages only on web servers. How do you target only them?

**Answer:**
Use `--limit` or `--tags`:

```bash
ansible-playbook site.yml --limit webservers
```

---

## âœ… Summary Best Practices Checklist

âœ… Use roles
âœ… Separate inventories
âœ… Encrypt secrets
âœ… Use tags
âœ… Use `check` mode
âœ… Test with `ansible-lint`
âœ… Use version control
âœ… Write clean, documented code
âœ… Follow idempotent task design
âœ… Automate with CI/CD

---

## ğŸ“š Official Resources

| Topic                     | Link                                                                                                     |
| ------------------------- | -------------------------------------------------------------------------------------------------------- |
| Ansible Best Practices    | [Best Practices Guide](https://docs.ansible.com/ansible/latest/user_guide/playbooks_best_practices.html) |
| Ansible Vault             | [Vault Docs](https://docs.ansible.com/ansible/latest/user_guide/vault.html)                              |
| Roles Overview            | [Roles Guide](https://docs.ansible.com/ansible/latest/user_guide/playbooks_reuse_roles.html)             |
| Linting Tools             | [ansible-lint](https://github.com/ansible/ansible-lint)                                                  |
| Molecule for Role Testing | [Molecule Docs](https://molecule.readthedocs.io/en/latest/)                                              |

---

Let me know if you want:

* âœ… Final summary notes
* ğŸ“¥ PDF of your complete Ansible learning path
* ğŸ“ Real-world project example using all best practices
